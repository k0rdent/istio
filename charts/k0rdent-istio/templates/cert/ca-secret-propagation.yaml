{{- if .Values.rootCA.enabled }}
apiVersion: k0rdent.mirantis.com/v1beta1
kind: MultiClusterService
metadata:
  name: {{ .Chart.Name }}-ca-secret-propagation
spec:
  clusterSelector:
    matchLabels:
      k0rdent.mirantis.com/istio-role: member
  serviceSpec:
    services:
      - name: secret-deployment
        namespace: {{ $.Release.Namespace }}
        template: {{ .Chart.Name }}-propagation
    templateResourceRefs:
      - identifier: Data
        resource:
          apiVersion: v1
          kind: Secret
          name: {{ $.Chart.Name }}-{{ `{{ .Cluster.metadata.namespace }}` }}-{{ `{{ .Cluster.metadata.name }}` }}-ca
          namespace: {{ $.Release.Namespace }}
{{- end }}